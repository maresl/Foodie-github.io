<%- include(`../partials/header`) %>
<h1>This is the Feeds Page</h1>
<p><a href="/logout">Log Out</a></p>
<p><a href="/profile/<%= currentUser._id %>">My Profile</a></p>
<p><a href="/post/newPost">Make a new post</a></p>

<% allPosts.forEach(post => { %>
    <div class="post">
        <div class="post-title">
            <div class="post-owner">
                <img class="small-profile-pic" src="<%= post.owner.profilePicture %>">
                <p><a href="/profile/<%= post.owner._id %>"><%= post.owner.userName %></a></p>
            </div>
           <div>
               <p><%= post.restaurant %></p>
           </div>
        </div>
        <img class="post-pic" src="<%= post.picture %>" alt="">
        <div class="post-body">
            <p><%= post.caption %></p>
            <h5>Comments:</h5>
            <% if (post.comments.length === 0 ) { %>
                <p>No comments yet!</p>
            <% } %>
            <% post.comments.forEach(comment => { %>
                <p><%= comment.owner.userName %>: <%= comment.comment %>
                </p>
            <% }) %> 

            <form action="/post/comment/<%= post._id %>" method="POST">
                <input type="text" name="comment" placeholder="comment">
                <button type="submit">Add Comment</button>
            </form>
            <% if(post.owner._id.equals(currentUser && currentUser._id)) { %>
            <form action="/post/delete/<%= post._id %>?_method=DELETE" method="POST">
                <button type="submit">Delete Post</button>
            </form>
            <form action="/post/edit/<%= post._id %>" method="GET">
                <button type="submit">Edit Post</button>
            </form>
            <% } %> 
        </div>
    </div>
<% }) %>

<%- include(`../partials/footer`) %>
